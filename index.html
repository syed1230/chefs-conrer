<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Recipe Generator & Planner</title>
    <meta name="description" content="Generate recipes from the ingredients you have, save them locally, and plan your weekly meals.">
    <meta name="keywords" content="recipes, AI recipe generator, meal planner, cooking">
    <link rel="icon" href="/favicon.ico" />
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Use Inter font -->
    <style>
    :root{
        --brand-1: #415fa6; /* dark navy */
        --accent: #fbc741dd; /* warm amber */
        --muted: #1a1c1e;
    }
    /* Update the background with a fallback local image */
body {
    margin: 0;
    padding: 0;
    font-family: 'Inter', sans-serif;
    background: url('https://img.freepik.com/vector-gratis/fondo-comida-dibujado-mano_23-2148047232.jpg') no-repeat center center fixed, url('./fallback-image.jpg') no-repeat center center fixed;
    background-size: cover;
    background-blend-mode: overlay;
    /* background-color: #f5e0c3; */
    box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.1);
}
    /* Custom CSS for the rotating spice wheel */
    @keyframes rotate360 {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    .custom-rotation-animation {
        /* The whole wheel rotates */
        animation: rotate360 10s linear infinite; 
    }

    /* FIX: Ensure the item origin is set correctly and the image doesn't spin */
    .spice-item {
        /* This is essential for the transformation to work relative to the center */
        position:absolute; 
        transform-origin: 50% 50%; /* Center the rotation on the item itself */
    }

    /* Circular Positioning for 10 items (36 degrees apart) */
    .spice-item:nth-child(1) { transform: rotate(0deg) translateY(-140px); }
    .spice-item:nth-child(2) { transform: rotate(36deg) translateY(-140px); }
    .spice-item:nth-child(3) { transform: rotate(72deg) translateY(-140px); }
    .spice-item:nth-child(4) { transform: rotate(108deg) translateY(-140px); }
    .spice-item:nth-child(5) { transform: rotate(144deg) translateY(-140px); }
    .spice-item:nth-child(6) { transform: rotate(180deg) translateY(-140px); }
    .spice-item:nth-child(7) { transform: rotate(216deg) translateY(-140px); }
    .spice-item:nth-child(8) { transform: rotate(252deg) translateY(-140px); }
    .spice-item:nth-child(9) { transform: rotate(288deg) translateY(-140px); }
    .spice-item:nth-child(10) { transform: rotate(324deg) translateY(-140px); }

    /* Food showcase card interaction styles */
    .food-card {
        position: relative;
        overflow: hidden;
        border-radius: 0.5rem; /* match rounded-lg */
    }
    .food-card .overlay {
        position: absolute;
        inset: 0;
        background: rgba(0,0,0,0);
        transition: background-color 240ms ease, opacity 240ms ease;
        pointer-events: none;
    }
    /* Subtle dark overlay on hover/active (modern look) */
    .food-card:hover .overlay,
    .food-card:focus-within .overlay,
    .food-card.is-active .overlay {
        background: rgba(0,0,0,0.45);
    }

    /* Active glow / ring */
    .food-card.is-active {
        box-shadow: 0 12px 30px rgba(0,0,0,0.35), 0 0 0 6px rgba(255,210,64,0.06);
        transform: translateY(-4px);
        transition: box-shadow 220ms ease, transform 220ms ease;
    }

    /* Caption shown on hover/active */
    .food-card .caption {
        position: absolute;
        left: 50%;
        bottom: 12px;
        transform: translateX(-50%) translateY(8px);
        color: #fff;
        font-weight: 600;
        background: rgba(0,0,0,0.35);
        padding: 6px 10px;
        border-radius: 9999px;
        opacity: 0;
        transition: opacity 220ms ease, transform 220ms ease;
        pointer-events: none;
        font-size: 0.9rem;
    }
    .food-card:hover .caption,
    .food-card.is-active .caption {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
    .food-card img {
        transition: transform 300ms ease;
        will-change: transform;
    }
    .food-card:hover img,
    .food-card:focus-within img,
    .food-card.is-active img {
        transform: scale(1.12);
    }

    /* Filter pill styles */
    .filter-pills { display:flex; gap:8px; overflow:auto; padding-bottom:6px; }
    .filter-pill { white-space:nowrap; display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:9999px; background:#f1f5f9; border:1px solid #e2e8f0; cursor:pointer; transition:transform 160ms ease, box-shadow 160ms ease; }
    .filter-pill.active { background:var(--accent); color:#fff; box-shadow:0 6px 18px rgba(15,23,42,0.12); transform:translateY(-2px); }

    /* Recipe card grid */
    .recipe-grid { display:grid; gap:16px; grid-template-columns: repeat(1, minmax(0,1fr)); }
    @media(min-width:640px){ .recipe-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media(min-width:1024px){ .recipe-grid{ grid-template-columns: repeat(3, minmax(0,1fr)); } }

    .recipe-card { background:#fff; border-radius:12px; overflow:hidden; box-shadow:0 6px 18px rgba(2,6,23,0.06); transition:transform 200ms ease, box-shadow 200ms ease; }
    .recipe-card:hover{ transform:translateY(-6px); box-shadow:0 18px 40px rgba(2,6,23,0.12); }
    .recipe-card .meta { padding:12px; }
    .fav-toggle { position:absolute; right:8px; top:8px; background:rgba(255,255,255,0.8); border-radius:9999px; padding:6px; }

    .empty-state { text-align:center; padding:32px; color:var(--muted); }

    /* Skeleton loader */
    .skeleton {
        display: grid;
        gap: 12px;
    }
    .skeleton .line {
        height: 14px;
        background: linear-gradient(90deg, #e6e9ef 25%, #f6f7fb 50%, #e6e9ef 75%);
        background-size: 200% 100%;
        animation: shimmer 1.2s linear infinite;
        border-radius: 6px;
    }
    .skeleton .line.title { height: 20px; width: 60%; }
    .skeleton .line.large { height: 120px; width: 100%; border-radius: 12px; }
    @keyframes shimmer { from { background-position: 200% 0 } to { background-position: -200% 0 } }

    /* Form fine-tuning */
    .field-label { display:block; font-weight:600; margin-bottom:6px; }
    .input-error { color:#dc2626; font-size:0.9rem; margin-top:6px; display:none; }
    .input-error.active { display:block; }

    /* Footer styles: dark, high-contrast, responsive */
    .site-footer { background: linear-gradient(180deg, #08121a, #071428); color: #e6eef6; }
    .site-footer a { color: #cfe8ff; }
    .site-footer .muted { color: #9fb6c8; }
    .footer-container { max-width: 1100px; margin: 0 auto; padding: 40px 20px; display:flex; gap:20px; align-items:flex-start; }
    .footer-brand { flex: 1 1 280px; }
    .footer-nav { flex: 1 1 220px; display:flex; gap:20px; }
    .footer-links { display:flex; flex-direction:column; gap:8px; }
    .footer-social { display:flex; gap:8px; margin-top:12px; }
    .footer-contact { flex: 1 1 300px; }
    .back-to-top { position: fixed; right: 20px; bottom: 24px; background: var(--accent); color: #071428; padding: 10px 12px; border-radius: 9999px; box-shadow: 0 6px 18px rgba(15,23,42,0.2); display:none; z-index: 60; }
    .back-to-top:focus { outline: 3px solid rgba(255,255,255,0.12); }
    @media(max-width:768px){ .footer-container{ flex-direction:column; padding:24px 16px; } .footer-nav{ flex-direction:row; gap:12px; } }

    /* Add a 3D circular spice wheel with rotation and glowing edges */
body {
    margin: 0;
    padding: 0;
    background: linear-gradient(to bottom, #f5e0c3, #e6c9a8);
    background-attachment: fixed;
    background-size: cover;
    font-family: 'Arial', sans-serif;
}

.hero-section {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    position: relative;
    overflow: hidden;
}

.spice-wheel {
    width: 300px;
    height: 300px;
    border-radius: 50%;
    background: radial-gradient(circle, #ffcc80, #ff8a65);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2), 0 0 30px rgba(255, 140, 0, 0.5);
    animation: rotate360 10s linear infinite;
    position: relative;
}

.spice-wheel::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    box-shadow: 0 0 20px rgba(255, 140, 0, 0.8);
    animation: pulseGlow 2s infinite;
}

@keyframes rotate360 {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(360deg);
    }
}

@keyframes pulseGlow {
    0%, 100% {
        box-shadow: 0 0 20px rgba(255, 140, 0, 0.8);
    }
    50% {
        box-shadow: 0 0 40px rgba(255, 140, 0, 1);
    }
}
</style>
        </style>
        <style>
            :root{ --orange:#e67e22; --green:#2ecc71; --bg:#fff; --text:#333; --muted:#6b7280; --card-shadow:0 10px 30px rgba(2,6,23,0.06); --radius:12px; --nav-height:64px }
            .tcc-nav, .tcc-footer { font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial; color:var(--text); box-sizing:border-box; }
            .tcc-nav{ position:sticky; top:0; z-index:1200; background:rgba(255,255,255,0.95); backdrop-filter: blur(6px); border-bottom:1px solid rgba(15,23,42,0.04); }
            .tcc-inner{ max-width:1200px; margin:0 auto; height:var(--nav-height); display:flex; align-items:center; justify-content:space-between; gap:20px; padding:0 18px }
            .tcc-brand{ display:flex; align-items:center; gap:12px; text-decoration:none; color:inherit }
            .tcc-logo{ font-weight:900; color:var(--orange); font-size:1.05rem }
            .tcc-menu{ display:flex; align-items:center; gap:10px; list-style:none; margin:0; padding:0 }
            .tcc-menu a{ padding:10px 12px; border-radius:10px; text-decoration:none; color:var(--text); font-weight:600 }
            .tcc-menu a:hover{ background: rgba(230,126,34,0.06) }
            .tcc-dropdown-menu{ position:absolute; top:calc(var(--nav-height) - 8px); left:0; background:var(--bg); border-radius:10px; box-shadow:var(--card-shadow); min-width:260px; padding:8px; transform-origin: top center; opacity:0; transform: translateY(-6px) scale(.98); transition: all 180ms cubic-bezier(.2,.9,.2,1); pointer-events:none; z-index:1400 }
            .tcc-dropdown:hover .tcc-dropdown-menu, .tcc-dropdown.open .tcc-dropdown-menu{ opacity:1; transform: translateY(0) scale(1); pointer-events:auto }
            .tcc-categories{ margin-top:6px; padding-top:6px; border-top:1px dashed rgba(15,23,42,0.04); display:grid; grid-template-columns:1fr 1fr; gap:6px }
            .tcc-user{ display:flex; align-items:center; gap:10px }
            .tcc-btn{ padding:8px 12px; border-radius:10px; border:1px solid rgba(15,23,42,0.06); background:transparent; cursor:pointer; font-weight:700 }
            .tcc-btn.primary{ background:linear-gradient(90deg,var(--orange),#ff9a3d); color:#fff; border:0; box-shadow:0 10px 22px rgba(230,126,34,0.12) }
            .tcc-hamburger{ display:none }
            @media (max-width:920px){ .tcc-menu{ display:none } .tcc-hamburger{ display:flex } .tcc-user .tcc-btn{ display:none } }
            .tcc-footer{ margin-top:42px; background:#08121a; color:#cfe8ff; padding:28px 18px; border-top: 4px solid rgba(230,126,34,0.10) }
            .tcc-footer .inner{ max-width:1200px; margin:0 auto; display:flex; gap:24px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap }
            .tcc-sitemap{ display:flex; gap:18px; flex-wrap:wrap }
            .tcc-sitemap .col{ min-width:160px }
            .tcc-sitemap a{ color:#cfe8ff; text-decoration:none; font-weight:600 }
            .tcc-socials{ display:flex; gap:12px; align-items:center }
        </style>
</head>
<body class="min-h-screen bg-gray-50 p-4 sm:p-8">

    <!-- NAVBAR START -->
    <header class="navbar">
        <div class="logo">The Chef's Corner</div>

        <nav class="nav-links" id="navLinks">
            <a href="front.html">Home</a>
            <a href="recipes.html">Recipes</a>
            <a href="about.html">About</a>
            <a href="contact.html">Contact</a>
            <a href="signin.html" class="btn-signin">Sign In</a>
            <a href="signup.html" class="btn-signup">Sign Up</a>
        </nav>

        <!-- Mobile Menu Icon -->
        <div class="hamburger" onclick="toggleMenu()">
            ‚ò∞
        </div>
    </header>

    <style>
    /* NAVBAR STYLING */
    .navbar {
        width: 100%;
        padding: 15px 40px;
        background-color: #fff;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 1000;
    }

    .logo {
        font-size: 1.8rem;
        font-weight: bold;
        color: #e67e22;
    }

    .nav-links a {
        margin-left: 25px;
        text-decoration: none;
        color: #444;
        font-weight: 600;
        transition: color .2s;
    }

    .nav-links a:hover {
        color: #e67e22;
    }

    /* Buttons */
    .btn-signin {
        padding: 8px 12px;
        border-radius: 6px;
        background: #3498db;
        color: white !important;
    }

    .btn-signup {
        padding: 8px 12px;
        border-radius: 6px;
        background: #2ecc71;
        color: white !important;
    }

    .btn-signin:hover { background: #2980b9 !important; }
    .btn-signup:hover { background: #27ae60 !important; }

    /* MOBILE MENU */
    .hamburger {
        display: none;
        font-size: 28px;
        cursor: pointer;
    }

    @media (max-width: 850px) {
        .nav-links {
            position: absolute;
            right: 0;
            top: 70px;
            background: white;
            width: 100%;
            text-align: center;
            flex-direction: column;
            padding: 20px 0;
            display: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .nav-links a {
            display: block;
            margin: 12px 0;
        }

        .hamburger {
            display: block;
        }
    }
    </style>

    <script>
    function toggleMenu() {
        const nav = document.getElementById("navLinks");
        nav.style.display = (nav.style.display === "block") ? "none" : "block";
    }
    </script>
    <!-- NAVBAR END -->
    <div class="max-w-7xl mx-auto">
        <header class="bg-white/90 backdrop-blur-sm rounded-xl shadow-md overflow-hidden">
            <div class="flex items-center justify-between px-6 py-4">
                <a href="front.html" class="flex items-center gap-4" aria-label="Go to landing page">
                    <img src="https://media.craiyon.com/2025-04-09/KD6qbdyyR3CMAF4DMTULGA.webp" alt="logo" class="w-12 h-12 rounded-md object-cover border-2 border-[var(--accent)]">
                    <div>
                        <h1 class="text-2xl font-bold" style="color:var(--brand-1);">Recipe<span style="color:var(--accent)">.</span></h1>
                        <p class="text-sm text-[var(--muted)]">AI-powered recipes from your pantry</p>
                    </div>
                </a>
                <div class="flex items-center gap-3">
                    <button id="cta-generate" class="bg-red-600 text-white px-4 py-2 rounded-md font-semibold hover:brightness-95">Generate a Recipe</button>
                    <button id="help-btn" aria-label="Help" class="px-3 py-2 rounded-md border hover:bg-gray-50">?</button>
                </div>
            </div>
        </header>
<!--FOOD SHOW CASE BOX -->

            <div class="lg:col-span-3 mt-4">
                <h2 class="text-4xl font-bold text-gray-800 mb-4 border-b pb-2 bg-gray-100 px-6 py-2 rounded-t-lg"> Food Showcase     üçΩÔ∏è</h2>
                
                <div id="foods-prepared-showcase" class="grid grid-cols-2 sm:grid-cols-4 gap-4 p-6 bg-white rounded-xl shadow-lg">
                    
                    <div class="food-card aspect-square overflow-hidden shadow-md transition duration-200">
                        <img src="https://www.deputy.com/uploads/2018/10/The-Most-Popular-Menu-Items-That-You-should-Consider-Adding-to-Your-Restaurant_Content-image1-min-1024x569.png" alt="Popular Menu Item 1" loading="lazy" decoding="async" class="w-full h-full object-cover">
                        <div class="overlay"></div>
                        <div class="caption">Classic Pasta</div>
                    </div>
                    <div class="food-card aspect-square overflow-hidden shadow-md transition duration-200">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQVkbRUYwBFo1QYlOVHdMBCcm-sO5-TljLNWb2Ik4Nvgt-Asska2jMWAkmt6k52_IQJCF8&usqp=CAU" alt="Popular Menu Item 2" loading="lazy" decoding="async" class="w-full h-full object-cover">
                        <div class="overlay"></div>
                        <div class="caption">Grilled Steak</div>
                    </div>
                    <div class="food-card aspect-square overflow-hidden shadow-md transition duration-200">
                        <img src="https://blog.swiggy.com/wp-content/uploads/2024/03/Biryani-2-1024x538.jpg" alt="Popular Menu Item 3" loading="lazy" decoding="async" class="w-full h-full object-cover">
                        <div class="overlay"></div>
                        <div class="caption">Spiced Biryani</div>
                    </div>
                    <div class="food-card aspect-square overflow-hidden shadow-md transition duration-200">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR8xkn7MAKFhdg9LjdN79YMydnPcoy4oWCNLjWsxnCsXbwLH98GNVpE1Li1MdQgLitt-cc&usqp=CAU" alt="Popular Menu Item 4" loading="lazy" decoding="async" class="w-full h-full object-cover">
                        <div class="overlay"></div>
                        <div class="caption">Fresh Salad</div>
                    </div>
                    <div class="food-card aspect-square overflow-hidden shadow-md transition duration-200">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQdy_N1gqryRuZGndsTDKij6fhop7pkIAiWhcD6fJ2m7OJeBNmxnX6HepZuZaz_m0bBzRc&usqp=CAU" alt="Popular Menu Item 5" loading="lazy" decoding="async" class="w-full h-full object-cover">
                        <div class="overlay"></div>
                        <div class="caption">Crispy Fries</div>
                    </div>
                    <div class="food-card aspect-square overflow-hidden shadow-md transition duration-200">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRdseExm8is3btu3bpCfjGBszTfKZYA-QD0-Y05wm6AHP9gh1ymtdxzt68apykJ3gn8gUY&usqp=CAU" alt="Popular Menu Item 6" loading="lazy" decoding="async" class="w-full h-full object-cover">
                        <div class="overlay"></div>
                        <div class="caption">Creamy Dessert</div>
                    </div>
                    <div class="food-card aspect-square overflow-hidden shadow-md transition duration-200">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ_kysRTBMMjyAhJ5UHH9BH_WFSogZ2QRDSVg&s" alt="Popular Menu Item 7" loading="lazy" decoding="async" class="w-full h-full object-cover">
                        <div class="overlay"></div>
                        <div class="caption">Homestyle Pie</div>
                    </div>
                    <div class="food-card aspect-square overflow-hidden shadow-md transition duration-200">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSO2ytrBqAxeob9HjGDLg1zJv_4IM9bq6dFWw&s" alt="Popular Menu Item 8" loading="lazy" decoding="async" class="w-full h-full object-cover">
                        <div class="overlay"></div>
                        <div class="caption">Seafood Platter</div>
                    </div>
            
                                </div> 
            
                    <script>
                    // Toggle .is-active on tap/click for mobile-friendly highlight + zoom
                    document.addEventListener('DOMContentLoaded', function(){
                        const cards = document.querySelectorAll('.food-card');
                        cards.forEach(card => {
                            card.addEventListener('click', function(e){
                                // toggle active state
                                card.classList.toggle('is-active');
                                // remove active from siblings
                                cards.forEach(c => { if(c !== card) c.classList.remove('is-active'); });
                            });
                        });

                        // tap outside to clear
                        document.addEventListener('click', function(e){
                            if(!e.target.closest('.food-card')){
                                cards.forEach(c => c.classList.remove('is-active'));
                            }
                        });
                    });
                    </script>
            </div>
        <div id="error-message-container">
            <!-- Error messages will be rendered here -->
        </div>
<br>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Generator panel -->
            <section class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg h-fit" id="generator-panel">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Generate New Recipe</h2>
                <p class="text-sm text-gray-600 mb-4">Enter ingredients (comma separated) and the AI will suggest a recipe.</p>

                <label for="ingredients-input" class="field-label">Ingredients</label>
                <div class="relative">
                    <svg class="absolute left-3 top-3 w-5 h-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7h18M3 12h18M3 17h18" />
                    </svg>
                    <textarea
                        id="ingredients-input"
                        class="w-full p-4 pl-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-[var(--accent)] focus:border-[var(--accent)] transition duration-150 resize-none h-36"
                        rows="4"
                        placeholder="e.g., chicken breast, canned tomatoes, penne pasta, mozzarella"
                        aria-label="Ingredients input"
                    ></textarea>
                </div>
                <p class="text-sm text-gray-500 mt-2">Tip: include quantities for better results. Example: "2 chicken breasts, 1 can tomatoes"</p>
                <div class="mt-4">
                    <button id="generate-button" class="w-full py-3 rounded-xl text-white font-bold transition-transform duration-200 bg-indigo-600 hover:scale-105 shadow-lg" disabled>Generate Recipe</button>
                </div>
            </section>

            <!-- Process panel -->
            <section class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg h-fit" id="process-panel">
                <div class="flex items-start justify-between">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">üë©üèª‚Äçüç≥ Your recipe process</h2>
                    <div class="text-sm text-gray-500">Results will appear here</div>
                </div>

                <div id="generated-recipe-container" class="bg-gray-50 p-6 rounded-lg text-gray-700 border border-dashed border-gray-200 mt-3" aria-live="polite">
                    <div id="generated-skeleton" class="skeleton" aria-hidden="true" style="display:none;">
                        <div class="line large"></div>
                        <div class="line title"></div>
                        <div class="line"></div>
                    </div>
                    <div id="generated-content" class="text-center text-gray-500 py-8">
                        <div class="text-6xl">üç≥</div>
                        <div class="mt-4">No recipe yet ‚Äî generate one from the left panel.</div>
                    </div>
                </div>

                <div class="mt-4 flex items-center gap-3">
                    <div class="flex rounded-md bg-white shadow-sm">
                        <button id="tab-ingredients" class="px-4 py-2 rounded-l-md bg-indigo-50 text-indigo-700">Ingredients</button>
                        <button id="tab-steps" class="px-4 py-2 rounded-r-md">Steps</button>
                    </div>
                    <button id="save-to-mealplan" class="ml-auto inline-flex items-center gap-2 px-4 py-2 bg-[var(--accent)] text-white rounded-md shadow hover:brightness-95">Save to Meal Plan</button>
                </div>

                <div id="generated-recipes" class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4" aria-live="polite">
                    <!-- Saved/generated cards will appear here -->
                </div>
            </section>
        </div>

        <!-- Weekly Meal Plan -->
        <div id="meal-plan-panel" class="mt-8 p-5 bg-gray-50 rounded-xl shadow-inner border border-gray-200">
            <h3 class="text-xl font-bold text-gray-800 mb-2">üìÖ Your Weekly Meal Plan</h3>
            <p class="text-sm text-gray-500 mb-3">Drag generated recipe cards here or use + to add.</p>

            <div id="meal-days" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="day-card p-3 bg-white border border-gray-200 rounded-lg shadow-sm flex flex-col" data-day="Mon">
                    <div class="flex items-center justify-between"><div class="font-semibold">Mon <span>üåû</span></div><button class="add-recipe px-2 py-1 text-sm rounded bg-indigo-50">+ Add</button></div>
                    <div class="drop-area mt-3 min-h-[80px]"></div>
                </div>
                <div class="day-card p-3 bg-white border border-gray-200 rounded-lg shadow-sm flex flex-col" data-day="Tue">
                    <div class="flex items-center justify-between"><div class="font-semibold">Tue <span>üåÆ</span></div><button class="add-recipe px-2 py-1 text-sm rounded bg-indigo-50">+ Add</button></div>
                    <div class="drop-area mt-3 min-h-[80px]"></div>
                </div>
                <div class="day-card p-3 bg-white border border-gray-200 rounded-lg shadow-sm flex flex-col" data-day="Wed">
                    <div class="flex items-center justify-between"><div class="font-semibold">Wed <span>ü•ó</span></div><button class="add-recipe px-2 py-1 text-sm rounded bg-indigo-50">+ Add</button></div>
                    <div class="drop-area mt-3 min-h-[80px]"></div>
                </div>
                <div class="day-card p-3 bg-white border border-gray-200 rounded-lg shadow-sm flex flex-col" data-day="Thu">
                    <div class="flex items-center justify-between"><div class="font-semibold">Thu <span>üçù</span></div><button class="add-recipe px-2 py-1 text-sm rounded bg-indigo-50">+ Add</button></div>
                    <div class="drop-area mt-3 min-h-[80px]"></div>
                </div>
            </div>

            <div class="mt-4">
                <button id="print-plan" class="w-full md:w-auto py-2 bg-pink-500 text-white rounded-xl font-bold transition duration-300 hover:bg-pink-600 shadow-md">Print / Share Plan</button>
            </div>
        </div>
            <div class="lg:col-span-3 mt-4">
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-base font-semibold text-gray-800">Filter by Tags:</span>
                        <button id="filter-toggle" class="text-sm text-gray-500 md:hidden">Filters</button>
                    </div>
                    <div id="filter-pills" class="filter-pills" role="toolbar" aria-label="Recipe filters">
                        <button class="filter-pill" data-filter="quick" aria-pressed="false">‚ö° Quick</button>
                        <button class="filter-pill" data-filter="vegetarian" aria-pressed="false">üå± Vegetarian</button>
                        <button class="filter-pill" data-filter="spicy" aria-pressed="false">üå∂Ô∏è Spicy</button>
                        <button class="filter-pill" data-filter="dessert" aria-pressed="false">üç∞ Dessert</button>
                    </div>
                </div>

                <section aria-label="Generated recipes">
                    <div id="recipes-container">
                        <div id="recipes-grid" class="recipe-grid">
                            <!-- recipe cards will be rendered here -->
                        </div>
                        <div id="recipes-empty" class="empty-state" style="display:none;">No recipes match your filters. Try different tags or generate a new recipe.</div>
                    </div>
                </section>
            </div>

<!--the design for the innner and outer circle here -->

<!----> 
<div id="error-message-container">
    <!-- Error messages will be rendered here --></div>

<!--ratating circle here -->
<div class="flex justify-center items-center py-10 mb-12"> 
    <div id="spice-wheel-outer-background" 
        class="relative flex justify-center items-center rounded-full 
                w-[400px] h-[400px] sm:w-[500px] sm:h-[500px] lg:w-[600px] lg:h-[600px]
                bg-amber-100 shadow-2xl border-4 border-yellow-400">
        
        <div id="rotating-spice-wheel" 
            class="absolute w-[280px] h-[280px] sm:w-[350px] sm:h-[350px] lg:w-[420px] lg:h-[420px] 
                    rounded-full bg-gradient-to-br from-gray-50 to-gray-200 
                    flex justify-center items-center custom-rotation-animation">
            
            <div class="spice-item absolute w-20 h-20 rounded-full overflow-hidden shadow-lg border-2 border-white">
                <img src="https://tiimg.tistatic.com/fp/1/005/636/dried-single-clove-spice-210.jpg" alt="Clove" class="w-full h-full object-cover">
            </div>
            <div class="spice-item absolute w-20 h-20 rounded-full overflow-hidden shadow-lg border-2 border-white">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ8q_LiZ2E2neiVY0DjCe3ResulqnIvIOfE6g&s" alt="Star Anise" class="w-full h-full object-cover">
            </div>
            <div class="spice-item absolute w-20 h-20 rounded-full overflow-hidden shadow-lg border-2 border-white">
                <img src="https://spiceitupp.com/wp-content/uploads/elementor/thumbs/Ceylon-Cinnamon-pi6javlgimr5nf5a4d53gbzzvhrd1m6ocvkzcy2olk.jpg" alt="Cinnamon" class="w-full h-full object-cover">
            </div>
            <div class="spice-item absolute w-20 h-20 rounded-full overflow-hidden shadow-lg border-2 border-white">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQJXpIb_TNqS_tHaF_8gwcJnXiyZJZCT7OkfA&s" alt="Black Peppercorn" class="w-full h-full object-cover">
            </div>
            <div class="spice-item absolute w-20 h-20 rounded-full overflow-hidden shadow-lg border-2 border-white">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTcj1VqgsUAxjXk9QNcYEEHGOQJ-yRCgFMfovt4mdcPp740aNgISTNPtNDBv5vIJiUh5qk&usqp=CAU" alt="Bay Leaf" class="w-full h-full object-cover">
            </div>
            <div class="spice-item absolute w-20 h-20 rounded-full overflow-hidden shadow-lg border-2 border-white">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ0yScyhPVl_Gm8PCkzbTtInqIDfAMm2jb16AUSoQdCvbHjy020cFfDci1bfZRNfnl2Bss&usqp=CAU" alt="Cardamom" class="w-full h-full object-cover">
            </div>
            <div class="spice-item absolute w-20 h-20 rounded-full overflow-hidden shadow-lg border-2 border-white">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ_90CmiDIMW8AMGlFuACAJfNDFB0kj7HIZ4g&s" alt="Nutmeg" class="w-full h-full object-cover">
            </div>
            <div class="spice-item absolute w-20 h-20 rounded-full overflow-hidden shadow-lg border-2 border-white">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRv8-ylFAvq4pQ3MRbYAL_kj2lrCBjOWmeRcgkLxICgATvS3RrRXrIZsWnjiNJZs6ZqHdM&usqp=CAU" alt="Turmeric" class="w-full h-full object-cover">
            </div>
            <div class="spice-item absolute w-20 h-20 rounded-full overflow-hidden shadow-lg border-2 border-white">
                <img src="https://images.squarespace-cdn.com/content/v1/587c90aee3df288ed1101a2d/1683543057923-AH9X0G8R0B69OI2OFBQH/Sweet+Allspice+Berries_s.jpg?format=500w" alt="Allspice" class="w-full h-full object-cover">
            </div>
            <div class="spice-item absolute w-20 h-20 rounded-full overflow-hidden shadow-lg border-2 border-white">
                <img src="https://img.freepik.com/premium-photo/plate-spices-with-one-many-different-spices_391229-10115.jpg" alt="Mixed Spices" class="w-full h-full object-cover">
            </div>
        </div>
    </div>
</div>
<div id="error-message-container">
</div>
<!-- --- Bottom Section: Local History --- -->
            <div class="lg:col-span-3 mt-4">
                <h2 class="text-4xl font-bold text-gray-800 mb-4 border-b pb-2 bg-gray-100 px-4 py-2 rounded-t-lg">Local Recipe History (<span id="favorites-count">0</span>)</h2>
                <p class="text-gray-600 mb-4">These recipes are saved in your browser and only visible to you.</p>
                
                <!-- SEARCH INPUT SECTION -->
                <div class="relative mb-6">
                    <input
                        type="text"
                        id="search-input"
                        placeholder="Search recipes by name or ingredient..."
                        class="w-full p-3 pl-10 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"
                    />
                    <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
                <!-- END SEARCH INPUT SECTION -->

                <div id="favorites-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Local history recipes will be rendered here -->
                </div>
            </div>

        </div>
    </div>

    <script type="module">
        
        // --- Global Constants ---
        const GEMINI_API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=";
        // IMPORTANT: If you run this code outside of the Canvas environment, 
        // you MUST replace the empty quotes below with your actual Gemini API Key string.
        const apiKey = "AIzaSyCJujCZ2zftDs6P07jCF5Pyj1ZWMKk-EoE"; 
        const RECIPE_HISTORY_KEY = 'ai_recipe_history'; // Key for localStorage

        // --- State Variables ---
        let allLocalRecipes = []; // Store all fetched recipes for local filtering
        let currentGeneratedRecipe = null;
        

        // --- DOM Elements ---
        const ingredientsInput = document.getElementById('ingredients-input');
        const generateButton = document.getElementById('generate-button');
        const errorContainer = document.getElementById('error-message-container');
        const recipeContainer = document.getElementById('generated-recipe-container');
        const favoritesList = document.getElementById('favorites-list');
        const favoritesCountSpan = document.getElementById('favorites-count');
        const searchInput = document.getElementById('search-input'); 

        // Extra UI elements
        const ctaGenerate = document.getElementById('cta-generate');
        const helpBtn = document.getElementById('help-btn');

        // Create a simple help modal
        const helpModalHtml = `
        <div id="help-modal" role="dialog" aria-modal="true" aria-hidden="true" class="fixed inset-0 flex items-center justify-center z-50" style="display:none;">
          <div class="bg-white rounded-xl p-6 max-w-lg w-full shadow-xl">
            <h3 class="text-xl font-bold mb-2">How to use Recipe Generator</h3>
            <p class="mb-4 text-sm text-gray-600">Type ingredients into the input, then click Generate. Save results to your history and drag them into the weekly plan.</p>
            <div class="flex justify-end gap-2">
              <button id="help-close" class="px-4 py-2 rounded-md bg-gray-100">Close</button>
            </div>
          </div>
        </div>`;
        document.body.insertAdjacentHTML('beforeend', helpModalHtml);
        const helpModal = document.getElementById('help-modal');
        document.getElementById('help-btn').addEventListener('click', ()=>{ helpModal.style.display='flex'; helpModal.setAttribute('aria-hidden','false'); });
        document.getElementById('help-close').addEventListener('click', ()=>{ helpModal.style.display='none'; helpModal.setAttribute('aria-hidden','true'); });

        // CTA scroll to generator
        ctaGenerate.addEventListener('click', ()=>{
            ingredientsInput.focus();
            window.scrollTo({ top: ingredientsInput.getBoundingClientRect().top + window.scrollY - 80, behavior: 'smooth' });
        });

        // Simple input validation: require at least 3 characters
        function validateIngredients(){
            const err = document.getElementById('ingredients-error');
            if(!ingredientsInput.value || ingredientsInput.value.trim().length < 3){
                generateButton.disabled = true;
                return false;
            }
            generateButton.disabled = false;
            return true;
        }
        ingredientsInput && ingredientsInput.addEventListener('input', validateIngredients);

        // show skeleton while generating (simulate)
        function showSkeleton(){
            document.getElementById('generated-skeleton').style.display='block';
            document.getElementById('generated-content').style.display='none';
        }
        function hideSkeleton(){
            document.getElementById('generated-skeleton').style.display='none';
            document.getElementById('generated-content').style.display='block';
        }

        generateButton && generateButton.addEventListener('click', async function(){
            if(!validateIngredients()) return;
            showSkeleton();
            generateButton.disabled = true;
            // Simulate an async request
            setTimeout(()=>{
                hideSkeleton();
                document.getElementById('generated-content').textContent = 'Generated recipe (demo): Combine ingredients and cook for 20 minutes.';
                generateButton.disabled = false;
            }, 1500);
        });

        // --- Utility Functions ---

        /**
         * Loads the recipe history from localStorage.
         * @returns {Array<object>} The recipe history array.
         */
        function loadLocalHistory() {
            try {
                const history = localStorage.getItem(RECIPE_HISTORY_KEY);
                return history ? JSON.parse(history) : [];
            } catch (e) {
                console.error("Error loading history from localStorage:", e);
                return [];
            }
        }

        /**
         * Saves the current recipe history array to localStorage.
         * @param {Array<object>} history - The array of recipes to save.
         */
        function saveLocalHistory(history) {
            try {
                localStorage.setItem(RECIPE_HISTORY_KEY, JSON.stringify(history));
            } catch (e) {
                console.error("Error saving history to localStorage:", e);
            }
        }

        /**
         * Displays an error or success message in the dedicated container.
         * @param {string} message 
         * @param {string} type - 'error' or 'success'
         */
        function renderMessage(message, type = 'error') {
            const baseClasses = "px-4 py-3 rounded-xl relative mb-6";
            const classes = type === 'success'
                ? "bg-green-100 border border-green-400 text-green-700"
                : "bg-red-100 border border-red-400 text-red-700";

            errorContainer.innerHTML = `
                <div class="${baseClasses} ${classes}">
                    <strong class="font-bold">${type === 'success' ? 'Success' : 'Error'}:</strong>
                    <span class="block sm:inline ml-2">${message}</span>
                </div>
            `;
            setTimeout(() => {
                errorContainer.innerHTML = '';
            }, 5000); // Clear after 5 seconds
        }

        /**
         * Renders the recipe object into an HTML string (RecipeCard equivalent).
         * @param {object} item - The recipe data.
         * @param {boolean} isHistoryItem - If true, displays delete button for history.
         */
        function renderRecipeCard(item, isHistoryItem = false) {
            const ingredientsHtml = item.ingredients?.map(ing => `<li class="ml-4">${ing}</li>`).join('') || '';
            const stepsHtml = item.steps?.map(step => `<li class="ml-4">${step}</li>`).join('') || '';

            const buttonHtml = isHistoryItem
                ? `<button data-id="${item.id}" class="delete-history mt-4 w-full bg-red-100 text-red-700 py-2 px-4 rounded-lg hover:bg-red-200 transition duration-150 font-semibold">
                    Remove from History
                   </button>`
                : `<button id="save-button" class="mt-4 w-full bg-indigo-500 text-white py-2 px-4 rounded-lg hover:bg-indigo-600 transition duration-150 font-semibold">
                    Save to Local History
                   </button>`;

            return `
                <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-indigo-500">
                    <h3 class="text-2xl font-extrabold text-gray-800 mb-2">${item.name}</h3>
                    
                    <p class="text-gray-600 italic mb-4">${item.description}</p>
                    
                    <div class="mb-4">
                        <h4 class="font-bold text-lg text-indigo-700 mb-1">Ingredients:</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            ${ingredientsHtml}
                        </ul>
                    </div>

                    <div class="mb-4">
                        <h4 class="font-bold text-lg text-indigo-700 mb-1">Steps:</h4>
                        <ol class="list-decimal list-inside space-y-2 text-sm text-gray-700">
                            ${stepsHtml}
                        </ol>
                    </div>
                    ${buttonHtml}
                </div>
            `;
        }


        // --- 1. History Listener and Renderer ---

        /**
         * Filters the global list of recipes based on the search query 
         * and renders the results to the DOM.
         */
        function filterAndRenderHistory() {
            const query = searchInput.value.toLowerCase().trim();
            let filteredList = allLocalRecipes;

            if (query) {
                filteredList = allLocalRecipes.filter(item => {
                    // Check recipe name
                    if (item.name.toLowerCase().includes(query)) return true;
                    // Check description
                    if (item.description.toLowerCase().includes(query)) return true;
                    // Check ingredients (joining array for simple search)
                    const ingredientsText = item.ingredients?.join(' ').toLowerCase() || '';
                    if (ingredientsText.includes(query)) return true;
                    
                    return false;
                });
            }

            // Render logic starts here
            favoritesList.innerHTML = '';
            favoritesCountSpan.textContent = filteredList.length;

            if (filteredList.length === 0 && allLocalRecipes.length > 0) {
                // If there are recipes, but none match the filter
                favoritesList.innerHTML = `
                    <div class="lg:col-span-2 bg-yellow-50 p-8 rounded-xl text-center text-yellow-700 border border-dashed border-yellow-300">
                        No recipes match your search query: <strong>"${searchInput.value}"</strong>
                    </div>
                `;
            } else if (filteredList.length === 0 && allLocalRecipes.length === 0) {
                 // If there are no recipes saved at all
                 favoritesList.innerHTML = `
                        <div class="lg:col-span-2 bg-gray-100 p-8 rounded-xl text-center text-gray-500 border border-dashed border-gray-300">
                            Your local recipe history is empty. Generate and save a recipe to start your collection!
                        </div>
                    `;
            } else {
                // Render the filtered list
                filteredList.forEach(item => {
                    const wrapper = document.createElement('div');
                    wrapper.innerHTML = renderRecipeCard(item, true);
                    favoritesList.appendChild(wrapper.firstChild);
                });
            }

            // Re-attach delete listeners after rendering
            attachDeleteListeners();
        }

        /**
         * Loads history from localStorage and starts the rendering process.
         */
        function loadAndRenderHistory() {
            // Load and sort history: most recent first
            allLocalRecipes = loadLocalHistory().sort((a, b) => b.timestamp - a.timestamp);
            filterAndRenderHistory();
            // Also render the recipes into the grid view (for filters / quick actions)
            renderRecipesGrid(allLocalRecipes);
        }
        
        /**
         * Attaches click listeners to all 'Remove from History' buttons.
         */
        function attachDeleteListeners() {
            document.querySelectorAll('.delete-history').forEach(button => {
                button.addEventListener('click', async (e) => {
                    const id = e.target.dataset.id;
                    if (id) {
                        deleteLocalRecipe(id);
                    }
                });
            });
        }


        // --- 2. LLM Generation Logic (with Structured Output and Backoff) ---

        /**
         * Calls the Gemini API to generate a structured recipe.
         */
        async function generateRecipe() {
            const ingredients = ingredientsInput.value.trim();
            if (!ingredients) {
                renderMessage("Please enter some ingredients.");
                return;
            }

            // Check if API key is present for external use
            if (!apiKey) {
                 renderMessage("Gemini API Key is missing. Please enter your key in the script block to enable recipe generation.", 'error');
                 return;
            }

            // Set loading state
            currentGeneratedRecipe = null;
            renderGeneratedRecipe(null, true);
            generateButton.disabled = true;
            generateButton.classList.remove('bg-indigo-500', 'hover:bg-indigo-600', 'shadow-lg', 'shadow-indigo-200', 'transform', 'hover:scale-[1.01]');
            generateButton.classList.add('bg-gray-400', 'cursor-not-allowed');


            const userPrompt = `Generate a single recipe in JSON format using the following primary ingredients: ${ingredients}. The recipe should be creative, include a name, a short description, and a list of detailed steps.`;

            const payload = {
                contents: [{ parts: [{ text: userPrompt }] }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "name": { "type": "STRING", "description": "The creative name of the dish." },
                            "description": { "type": "STRING", "description": "A short, appetizing description." },
                            "ingredients": { "type": "ARRAY", "items": { "type": "STRING" } },
                            "steps": { "type": "ARRAY", "items": { "type": "STRING" } } 
                        },
                        required: ["name", "description", "ingredients", "steps"]
                    }
                }
            };
            
            const maxRetries = 5;

            for (let attempt = 0; attempt < maxRetries; attempt++) {
                try {
                    const response = await fetch(GEMINI_API_URL + apiKey, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                    const result = await response.json();
                    const jsonText = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (jsonText) {
                        const parsedRecipe = JSON.parse(jsonText);
                        currentGeneratedRecipe = parsedRecipe;
                        renderGeneratedRecipe(parsedRecipe, false);
                        
                        // Re-enable button on success
                        generateButton.disabled = false;
                        generateButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
                        generateButton.classList.add('bg-indigo-500', 'hover:bg-indigo-600', 'shadow-lg', 'shadow-indigo-200', 'transform', 'hover:scale-[1.01]');
                        return;
                    } else {
                        throw new Error("API response was empty or malformed.");
                    }
                } catch (e) {
                    console.warn(`Attempt ${attempt + 1} failed:`, e);
                    if (attempt === maxRetries - 1) {
                        renderMessage("Failed to generate recipe after multiple attempts. Please try again.");
                        renderGeneratedRecipe(null, false);
                        
                        // Re-enable button on failure
                        generateButton.disabled = false;
                        generateButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
                        generateButton.classList.add('bg-indigo-500', 'hover:bg-indigo-600', 'shadow-lg', 'shadow-indigo-200', 'transform', 'hover:scale-[1.01]');
                    } else {
                        const delay = Math.pow(2, attempt) * 1000; // Exponential backoff
                        await new Promise(resolve => setTimeout(resolve, delay));
                    }
                }
            }
        }

        /**
         * Renders the generated recipe result or a status message.
         * @param {object | null} recipe - The recipe object to display.
         * @param {boolean} isLoading - Whether the generation is in progress.
         */
        function renderGeneratedRecipe(recipe, isLoading) {
            recipeContainer.className = 'p-8 rounded-xl text-center border border-dashed border-gray-300';
            
            if (isLoading) {
                recipeContainer.classList.add('bg-blue-50', 'text-blue-500');
                recipeContainer.classList.remove('bg-gray-100', 'text-gray-500');
                recipeContainer.innerHTML = `
                    <div class="flex items-center justify-center">
                        <svg class="animate-spin -ml-1 mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Generating Recipe...
                    </div>
                `;
            } else if (recipe) {
                recipeContainer.classList.remove('bg-blue-50', 'text-blue-500', 'bg-gray-100', 'text-gray-500');
                recipeContainer.innerHTML = renderRecipeCard(recipe, false);
                // Attach save listener immediately after rendering the save button
                document.getElementById('save-button')?.addEventListener('click', () => saveRecipe(currentGeneratedRecipe));

            } else {
                recipeContainer.classList.add('bg-gray-100', 'text-gray-500');
                recipeContainer.classList.remove('bg-blue-50', 'text-blue-500');
                recipeContainer.innerHTML = 'Enter your ingredients and hit \'Generate Recipe\' to get started.';
            }
        }


        // --- 3. Local Storage Actions ---

        /**
         * Saves the generated recipe to local history.
         * @param {object} recipeToSave - The recipe object.
         */
        function saveRecipe(recipeToSave) {
            
            // Add unique ID and timestamp before saving
            const newRecipe = {
                ...recipeToSave,
                id: crypto.randomUUID(),
                timestamp: Date.now()
            };

            const currentHistory = loadLocalHistory();
            currentHistory.push(newRecipe);
            saveLocalHistory(currentHistory);

            // Clear generated recipe view and refresh history list
            currentGeneratedRecipe = null;
            renderGeneratedRecipe(null, false);
            loadAndRenderHistory();

            renderMessage('Recipe saved successfully to your local history!', 'success');
            // Also add the newly saved recipe into the recipe grid immediately
            try { addRecipeCardToGrid(newRecipe); } catch(e){ /* noop if grid not ready */ }
        }

        // --- Recipe Grid Rendering & Filter Handling ---

        /**
         * Renders a list of recipes into the #recipes-grid container.
         * @param {Array<object>} recipes
         */
        function renderRecipesGrid(recipes){
            const grid = document.getElementById('recipes-grid');
            const empty = document.getElementById('recipes-empty');
            if(!grid) return;
            grid.innerHTML = '';
            if(!recipes || recipes.length === 0){
                empty.style.display = 'block';
                return;
            }
            empty.style.display = 'none';
            recipes.forEach(r => {
                const el = createRecipeCardElement(r);
                grid.appendChild(el);
            });
        }

        /**
         * Create a DOM element for a recipe card used in the grid.
         * @param {object} r
         */
        function createRecipeCardElement(r){
            const el = document.createElement('article');
            el.className = 'recipe-card relative';
            el.dataset.id = r.id || '';
            el.innerHTML = `
                <div class="relative h-40 bg-gray-100 overflow-hidden">
                    <img src="${r.image || 'https://via.placeholder.com/600x400?text=Recipe'}" alt="${escapeHtml(r.name)}" loading="lazy" decoding="async" class="w-full h-full object-cover">
                    <button class="fav-toggle" aria-pressed="${r.favorite ? 'true' : 'false'}" title="Toggle favorite">${r.favorite ? '‚òÖ' : '‚òÜ'}</button>
                </div>
                <div class="meta">
                    <h3 class="font-bold text-lg">${escapeHtml(r.name)}</h3>
                    <p class="text-sm text-gray-600 mt-1">${escapeHtml(r.description || '')}</p>
                    <div class="mt-3 flex gap-2">
                        <button class="view-detail px-3 py-1 bg-indigo-50 text-indigo-700 rounded-md text-sm">View</button>
                        <button class="use-recipe px-3 py-1 bg-green-50 text-green-700 rounded-md text-sm">Use</button>
                    </div>
                </div>
            `;

            // Make this card draggable for meal plan
            el.classList.add('recipe-draggable');
            el.setAttribute('draggable', 'true');
            el.addEventListener('dragstart', (e)=>{
                e.dataTransfer.setData('text/recipe-id', r.id || JSON.stringify(r));
                el.classList.add('opacity-60');
            });
            el.addEventListener('dragend', ()=>el.classList.remove('opacity-60'));

            // Favorite toggle
            el.querySelector('.fav-toggle')?.addEventListener('click', (ev)=>{
                ev.stopPropagation();
                r.favorite = !r.favorite;
                // persist change
                const history = loadLocalHistory().map(item => item.id === r.id ? {...item, favorite: r.favorite} : item);
                saveLocalHistory(history);
                // reflect UI
                el.querySelector('.fav-toggle').textContent = r.favorite ? '‚òÖ' : '‚òÜ';
                el.querySelector('.fav-toggle').setAttribute('aria-pressed', r.favorite ? 'true' : 'false');
                // update global state
                allLocalRecipes = history;
            });

            // View detail -> render into main generated container
            el.querySelector('.view-detail')?.addEventListener('click', ()=>{
                currentGeneratedRecipe = r;
                renderGeneratedRecipe(r, false);
                window.scrollTo({ top: recipeContainer.getBoundingClientRect().top + window.scrollY - 80, behavior: 'smooth' });
            });

            // Use -> quick save to meal plan 'today' (Mon) as example
            el.querySelector('.use-recipe')?.addEventListener('click', ()=>{
                addRecipeToDay('Mon', r);
                renderMessage('Added to Monday in your meal plan', 'success');
            });

            return el;
        }

        function addRecipeCardToGrid(recipe){
            const grid = document.getElementById('recipes-grid');
            if(!grid) return;
            const el = createRecipeCardElement(recipe);
            grid.prepend(el);
        }

        // Simple HTML escape helper
        function escapeHtml(str){
            if(!str) return '';
            return String(str).replace(/[&<>"']/g, (s)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[s]);
        }

        // Filter pill behavior
        (function wireFilterPills(){
            const pills = document.querySelectorAll('.filter-pill');
            if(!pills) return;
            pills.forEach(p => p.addEventListener('click', ()=>{
                const active = p.classList.toggle('active');
                p.setAttribute('aria-pressed', active ? 'true' : 'false');
                applyFilterPills();
            }));
        })();

        function applyFilterPills(){
            const active = Array.from(document.querySelectorAll('.filter-pill.active')).map(b => b.dataset.filter);
            if(active.length === 0){ renderRecipesGrid(allLocalRecipes); return; }
            const filtered = allLocalRecipes.filter(r => {
                const tags = r.tags || [];
                return active.every(f => tags.includes(f));
            });
            renderRecipesGrid(filtered);
        }

        /**
         * Deletes a recipe from the local history.
         * @param {string} id - The unique ID of the recipe to delete.
         */
        function deleteLocalRecipe(id) {
            const currentHistory = loadLocalHistory();
            const updatedHistory = currentHistory.filter(recipe => recipe.id !== id);
            
            saveLocalHistory(updatedHistory);
            
            // Update the state and re-render the list
            loadAndRenderHistory();
            renderMessage('Recipe removed from history.', 'success');
        }


        // --- 4. Initialization ---
        window.onload = () => {
            // Load history immediately on page load
            loadAndRenderHistory();
            
            generateButton.addEventListener('click', generateRecipe);
            // Attach the filter function to the search input event
            searchInput.addEventListener('input', filterAndRenderHistory); 
            
            // Initialize drag & drop for generated cards and meal plan days
            initDragAndDrop();
            // Clean meal plan of entries without images or known bad names, then render
            renderSavedMealPlan();
        };
        
        // --- Drag and Drop + Meal Plan Persistence ---
        const MEAL_PLAN_KEY = 'ai_meal_plan';

        function initDragAndDrop(){
            // make generated recipe cards draggable when they are added
            const container = document.getElementById('generated-recipes');
            const observer = new MutationObserver(()=>{
                container.querySelectorAll('.recipe-draggable').forEach(card=>{
                    if(!card.getAttribute('draggable')){
                        card.setAttribute('draggable','true');
                        card.addEventListener('dragstart', (e)=>{
                            e.dataTransfer.setData('text/recipe-id', card.dataset.id || card.id || JSON.stringify({name:card.dataset.name}));
                            card.classList.add('opacity-60');
                        });
                        card.addEventListener('dragend', ()=>card.classList.remove('opacity-60'));
                    }
                });
            });
            observer.observe(container, { childList: true, subtree: true });

            // configure drop areas
            document.querySelectorAll('.drop-area').forEach(area=>{
                area.addEventListener('dragover', (e)=>{ e.preventDefault(); area.classList.add('ring-2','ring-indigo-300'); });
                area.addEventListener('dragleave', ()=>{ area.classList.remove('ring-2','ring-indigo-300'); });
                area.addEventListener('drop', (e)=>{
                    e.preventDefault(); area.classList.remove('ring-2','ring-indigo-300');
                    const data = e.dataTransfer.getData('text/recipe-id');
                    try{
                        const parsed = JSON.parse(data);
                        addRecipeToDay(area.closest('.day-card').dataset.day, parsed);
                    } catch(err){
                        // it's likely an id string, try to find recipe in local history
                        const id = data;
                        const recipe = loadLocalHistory().find(r=>r.id===id);
                        if(recipe) addRecipeToDay(area.closest('.day-card').dataset.day, recipe);
                    }
                });
            });
        }

        function addRecipeToDay(day, recipe){
            const plan = loadMealPlan();
            plan[day] = plan[day] || [];
            plan[day].push(recipe);
            saveMealPlan(plan);
            renderSavedMealPlan();
        }

        function loadMealPlan(){
            try{ const raw = localStorage.getItem(MEAL_PLAN_KEY); return raw ? JSON.parse(raw) : {}; } catch(e){ return {}; }
        }

        function saveMealPlan(plan){
            try{ localStorage.setItem(MEAL_PLAN_KEY, JSON.stringify(plan)); } catch(e){ console.error(e); }
        }

        function renderSavedMealPlan(){
            const plan = loadMealPlan();
            document.querySelectorAll('.day-card').forEach(card=>{
                const day = card.dataset.day;
                const area = card.querySelector('.drop-area');
                area.innerHTML = '';
                (plan[day]||[]).forEach((item, idx)=>{
                    const el = document.createElement('div');
                    el.className = 'p-2 bg-white border rounded-md mb-2 shadow-sm recipe-draggable flex items-center justify-between';
                    el.dataset.id = item.id || JSON.stringify(item);

                    // Name / label
                    const nameWrap = document.createElement('div');
                    nameWrap.className = 'flex-1 text-sm text-gray-800';
                    nameWrap.textContent = item.name || item;

                    // Remove button
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'ml-3 text-sm text-red-600 px-2 py-1 rounded bg-red-50 hover:bg-red-100';
                    removeBtn.type = 'button';
                    removeBtn.setAttribute('aria-label', `Remove ${item.name || 'recipe'} from ${day}`);
                    removeBtn.textContent = 'Remove';
                    removeBtn.addEventListener('click', ()=> removeRecipeFromDay(day, idx));

                    el.appendChild(nameWrap);
                    el.appendChild(removeBtn);
                    area.appendChild(el);
                });
            });
        }

        /**
         * Remove a recipe from a specific day by index and persist the meal plan.
         * @param {string} day
         * @param {number} idx
         */
        function removeRecipeFromDay(day, idx){
            const plan = loadMealPlan();
            if(!plan[day] || !Array.isArray(plan[day])) return;
            // Guard: ensure index exists
            if(idx < 0 || idx >= plan[day].length) return;
            plan[day].splice(idx, 1);
            saveMealPlan(plan);
            renderSavedMealPlan();
            renderMessage('Removed recipe from ' + day, 'success');
        }
        
    </script>
    <!-- Footer: professional, accessible, responsive -->
    <footer class="site-footer mt-12" role="contentinfo">
        <div class="footer-container">
            <div class="footer-brand">
                <div class="flex items-center gap-3">
                    <img src="https://media.craiyon.com/2025-04-09/KD6qbdyyR3CMAF4DMTULGA.webp" alt="logo" class="w-12 h-12 rounded-md border-2 border-[var(--accent)]">
                    <div>
                        <div class="text-lg font-bold">Your Name <span style="color:var(--accent)">.</span></div>
                        <div class="muted text-sm">AI Recipe Generator & Weekly Planner ‚Äî helping cooks make better meals from what they have.</div>
                    </div>
                </div>
                <div class="footer-social" aria-label="Social links">
                    <a href="https://github.com/" target="_blank" rel="noopener" aria-label="GitHub profile" title="GitHub"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.373 0 12c0 5.303 3.438 9.8 8.205 11.387.6.113.82-.263.82-.583 0-.287-.01-1.04-.015-2.04-3.338.726-4.042-1.61-4.042-1.61-.546-1.387-1.333-1.757-1.333-1.757-1.09-.745.083-.73.083-.73 1.205.085 1.84 1.238 1.84 1.238 1.07 1.834 2.81 1.304 3.495.997.108-.775.42-1.305.762-1.605-2.665-.305-5.467-1.332-5.467-5.93 0-1.31.468-2.38 1.235-3.22-.124-.303-.535-1.523.117-3.176 0 0 1.008-.322 3.3 1.23.96-.267 1.99-.4 3.01-.405 1.02.005 2.05.138 3.01.405 2.29-1.552 3.296-1.23 3.296-1.23.654 1.653.243 2.873.12 3.176.77.84 1.235 1.91 1.235 3.22 0 4.61-2.807 5.62-5.48 5.92.43.37.81 1.096.81 2.21 0 1.596-.015 2.88-.015 3.27 0 .32.216.702.825.583C20.565 21.795 24 17.297 24 12 24 5.373 18.627 0 12 0z"/></svg></a>
                    <a href="https://linkedin.com/" target="_blank" rel="noopener" aria-label="LinkedIn profile" title="LinkedIn"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M4.98 3.5C4.98 4.88 3.88 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1 4.98 2.12 4.98 3.5zM0 8h5v16H0V8zm7.5 0h4.75v2.2h.07c.66-1.25 2.28-2.6 4.7-2.6 5.03 0 5.95 3.32 5.95 7.65V24H18.1v-7.1c0-1.7-.03-3.9-2.38-3.9-2.38 0-2.74 1.86-2.74 3.77V24H7.5V8z"/></svg></a>
                    <a href="https://twitter.com/" target="_blank" rel="noopener" aria-label="Twitter profile" title="Twitter"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M24 4.557a9.83 9.83 0 01-2.828.775 4.932 4.932 0 002.164-2.724c-.951.564-2.005.974-3.127 1.195a4.916 4.916 0 00-8.38 4.482C7.69 7.695 4.066 5.88 1.64 3.161a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096A4.904 4.904 0 01.96 9.1v.06a4.915 4.915 0 003.95 4.814c-.832.22-1.71.27-2.63.1a4.918 4.918 0 004.588 3.417A9.867 9.867 0 010 19.54a13.94 13.94 0 007.548 2.212c9.142 0 14.307-7.72 14.307-14.408 0-.22-.004-.437-.014-.653A10.18 10.18 0 0024 4.557z"/></svg></a>
                </div>
            </div>

            <nav class="footer-nav" aria-label="Footer navigation">
                <div class="footer-links">
                    <a href="#" class="text-sm">Home</a>
                    <a href="#" class="text-sm">About</a>
                    <a href="#" class="text-sm">Contact</a>
                </div>
                <div class="footer-links">
                    <a href="#" class="text-sm">Privacy</a>
                    <a href="#" class="text-sm">Terms</a>
                </div>
            </nav>

            <div class="footer-contact">
                <form id="footer-contact-form" class="space-y-2" aria-label="Contact form">
                    <label for="footer-email" class="text-sm muted">Contact me</label>
                    <input id="footer-email" type="email" placeholder="you@domain.com" class="w-full p-2 rounded-md" required aria-required="true">
                    <textarea id="footer-message" placeholder="Short message (optional)" class="w-full p-2 rounded-md" rows="2"></textarea>
                    <div class="flex items-center gap-2">
                        <button id="footer-send" type="submit" class="px-3 py-2 rounded-md bg-[var(--accent)] text-white">Send</button>
                        <div id="footer-form-status" class="text-sm muted" role="status" aria-live="polite"></div>
                    </div>
                </form>
            </div>
        </div>

        <div class="text-center muted text-sm py-4">&copy; <span id="footer-year"></span> Your Name ‚Äî Built with care. <a href="#" class="ml-2">Privacy</a></div>
    </footer>

    <button id="back-to-top" class="back-to-top" aria-label="Back to top">‚Üë Top</button>

    <script>
        // Set current year
        document.getElementById('footer-year').textContent = new Date().getFullYear();

        // Back to top logic
        const backToTop = document.getElementById('back-to-top');
        window.addEventListener('scroll', ()=>{
            if(window.scrollY > 300) backToTop.style.display = 'block'; else backToTop.style.display = 'none';
        });
        backToTop.addEventListener('click', ()=> window.scrollTo({ top: 0, behavior: 'smooth' }));

        // Footer contact form validation and mock submission
        const footerForm = document.getElementById('footer-contact-form');
        footerForm.addEventListener('submit', (e)=>{
            e.preventDefault();
            const email = document.getElementById('footer-email').value.trim();
            const status = document.getElementById('footer-form-status');
            if(!email || !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)){
                status.textContent = 'Please provide a valid email.';
                status.style.color = '#ffb4b4';
                return;
            }
            // Mock send (no network) ‚Äî show success and clear
            status.textContent = 'Thanks ‚Äî I will get back to you soon!';
            status.style.color = '#bfe9c1';
            footerForm.reset();
        });

        // Make footer links open in new tabs where appropriate and add focus outlines for accessibility
        document.querySelectorAll('.site-footer a').forEach(a=>{
            a.setAttribute('target','_blank');
            a.setAttribute('rel','noopener');
            a.addEventListener('focus', ()=> a.style.outline = '3px solid rgba(255,255,255,0.08)');
            a.addEventListener('blur', ()=> a.style.outline = 'none');
        });
    </script>
</body>
</html>
